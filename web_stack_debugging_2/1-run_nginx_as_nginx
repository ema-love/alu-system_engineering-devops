#!/usr/bin/env bash
# Script that configures Nginx to run as nginx user on port 8080

# Change nginx to run as nginx user
sed -i 's/^user .*/user nginx;/' /etc/nginx/nginx.conf

# Change port 80 to 8080 in default site
sed -i 's/80/8080/g' /etc/nginx/sites-enabled/default

# Fix permissions for nginx user to access necessary files
chmod 644 /etc/nginx/nginx.conf
chmod -R 755 /etc/nginx/
chmod -R 755 /var/log/nginx/
chmod -R 755 /usr/share/nginx/
chmod -R 755 /var/lib/nginx/

# Kill any running nginx processes
pkill nginx

# Start nginx as nginx user (both master and worker processes)
su -s /bin/bash nginx -c "nginx"
