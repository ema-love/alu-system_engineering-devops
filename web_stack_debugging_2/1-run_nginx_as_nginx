#!/usr/bin/env bash
# Script that configures Nginx to run as nginx user on port 8080

# Change nginx to run as nginx user
sed -i 's/^user .*/user nginx;/' /etc/nginx/nginx.conf

# Change port 80 to 8080 in default site
sed -i 's/80/8080/g' /etc/nginx/sites-enabled/default

# Fix permissions for nginx user
chown nginx:nginx /var/log/nginx/*.log 2>/dev/null || true
chmod 644 /var/log/nginx/*.log 2>/dev/null || true

# Kill any running nginx
pkill -9 nginx 2>/dev/null || true

# Start nginx
nginx
